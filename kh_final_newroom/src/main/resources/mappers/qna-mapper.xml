<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna">

<insert id="write" parameterType="QnaDto"> <!-- 질문 작성 -->
	INSERT INTO qna 
	(BNUM, BTITLE, USERID, BREADCNT, BWRITEDATE, BCONTENT, BLEVEL, QUESTIONNUM)
	VALUES((SELECT NVL(MAX(BNUM), 0) + 1 FROM QNA)
		 ,#{btitle},#{userid},default,default,#{bcontent},
		 <if test="bnum == null">
		 (SELECT NVL(MAX(BNUM), 0) + 1 FROM QNA)
		</if>
		<if test="bnum != null">
			#{bnum}	
		</if>
		 ,(SELECT NVL(MAX(QUESTIONNUM), 0) + 1 FROM QNA)
		 )
</insert>

<update id="updateReadcnt" parameterType="int"> <!-- 조회수 증가 -->
	UPDATE qna SET BREADCNT = BREADCNT+1 WHERE BNUM=#{bnum}
</update>

<select id="getBoard" parameterType="_int" resultType="QnaDto"> <!-- 질문 상세 -->
	SELECT * FROM qna WHERE BNUM=#{bnum}
</select>

<update id="update" parameterType="QnaDto"><!-- 질문 수정 -->
	update qna set btitle=#{btitle}, bcontent=#{bcontent}, bwritedate=default where bnum=#{bnum}
</update>

<delete id="delete" parameterType="int"> <!--  질문 삭제 -->
	delete from qna where bnum = #{bnum}
</delete>

<!-- 질문 검색 -->
<select id="searchTitle" parameterType="String" resultType="QnaDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate, 'YYYY-MM-DD HH24:MI') bwritedate, bcontent, questionnum, isFAQ
	  FROM qna WHERE btitle like #{keyword} ORDER BY bnum DESC
</select>

<select id="searchContent" parameterType="String" resultType="QnaDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate, 'YYYY-MM-DD HH24:MI') bwritedate, bcontent, questionnum, isFAQ
	  FROM qna WHERE bcontent like #{keyword} ORDER BY bnum DESC
</select>

<select id="searchWriter" parameterType="String" resultType="QnaDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate, 'YYYY-MM-DD HH24:MI') bwritedate, bcontent, questionnum, isFAQ
	  FROM qna WHERE userid like #{keyword} ORDER BY bnum DESC
</select>

<select id="getFAQList" resultType="QnaDto"> 
	SELECT * FROM qna WHERE isFAQ = 'T'
</select>

</mapper>