<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">

<select id="selectTotalCount" resultType="int">
	SELECT COUNT(*) FROM notice
</select>

<insert id="write" parameterType="NoticeDto">
	INSERT INTO notice 
	(bnum, BTITLE, USERID, BREADCNT, BWRITEDATE, BCONTENT)
	VALUES(
		 (SELECT NVL(MAX(bnum),0) + 1 FROM NOTICE)
		 ,#{btitle},#{userid},#{breadcnt},default,#{bcontent})
</insert>

<update id="updateReadcnt" parameterType="int">
	UPDATE notice SET BREADCNT = BREADCNT+1 WHERE BNUM=#{bnum}
</update>

<select id="selectBoard" parameterType="int" resultType="NoticeDto">
	SELECT * FROM notice WHERE BNUM=#{bnum}
</select>

<update id="update" parameterType="NoticeDto">
	update notice set btitle=#{btitle}, bcontent=#{bcontent}, bwritedate=default where bnum=#{bnum}
</update>

<delete id="delete" parameterType="int">
	delete from notice where bnum = #{bnum}
</delete>

<select id="searchTitle" parameterType="String" resultType="NoticeDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate,'YYYY-DD-MM HH24:MM') bwritedate,bcontent,cmtcnt
	  FROM notice WHERE btitle like #{title}
</select>

<select id="searchContent" parameterType="String" resultType="NoticeDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate,'YYYY-DD-MM HH24:MM') bwritedate,bcontent,cmtcnt
	  FROM notice WHERE bcontent like #{keyword}
</select>

<select id="searchWriter" parameterType="String" resultType="NoticeDto">
	SELECT bnum, btitle, userid, breadcnt, TO_CHAR(bwritedate,'YYYY-DD-MM HH24:MM') bwritedate,bcontent,cmtcnt
	  FROM notice WHERE userid like #{keyword}
</select>

<select id="selectPage" parameterType="map" resultType="NoticeDto">
	SELECT *
	  FROM (SELECT ROWNUM AS N
	   			 , bnum
	   			 , btitle
	   			 , userid
	   			 , breadcnt
	   			 , bwritedate
	   			 , bcontent
	   			 , cmtcnt
	   		  FROM (SELECT * FROM NOTICE ORDER BY bnum ASC))
	 WHERE N BETWEEN #{start} AND #{end}
		
</select>

<select id="selectTotalRowCount" resultType="_int">
	SELECT COUNT(*) FROM NOTICE
</select>

</mapper>